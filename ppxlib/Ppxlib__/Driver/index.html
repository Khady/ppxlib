<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Driver (ppxlib.Ppxlib__.Driver)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">ppxlib</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Ppxlib__.Driver</span></h1></header><div class="spec val" id="val-add_arg"><a href="#val-add_arg" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>add_arg : Caml.Arg.key <span class="keyword">&#8209;&gt;</span> Caml.Arg.spec <span class="keyword">&#8209;&gt;</span> doc:<a href="../index.html#module-Import">Ppxlib__.Import</a>.string <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"><p>Add one argument to the command line</p></div></div><div class="spec module" id="module-Lint_error"><a href="#module-Lint_error" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Lint_error/index.html">Lint_error</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Error reported by linters</p></div></div><div class="spec module" id="module-Cookies"><a href="#module-Cookies" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Cookies/index.html">Cookies</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec val" id="val-register_transformation"><a href="#val-register_transformation" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>register_transformation : ?&#8288;extensions:<a href="../../Ppxlib/Extension/index.html#type-t">Ppxlib.Extension.t</a> <a href="../index.html#module-Import">Ppxlib__.Import</a>.list <span class="keyword">&#8209;&gt;</span> ?&#8288;rules:<a href="../../Ppxlib/Context_free/Rule/index.html#type-t">Ppxlib.Context_free.Rule.t</a> <a href="../index.html#module-Import">Ppxlib__.Import</a>.list <span class="keyword">&#8209;&gt;</span> ?&#8288;enclose_impl:(<a href="../../Ppxlib/Location/index.html#type-t">Ppxlib.Location.t</a> <a href="../index.html#module-Import">Ppxlib__.Import</a>.option <span class="keyword">&#8209;&gt;</span> <a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a><span class="keyword"> * </span><a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a>) <span class="keyword">&#8209;&gt;</span> ?&#8288;enclose_intf:(<a href="../../Ppxlib/Location/index.html#type-t">Ppxlib.Location.t</a> <a href="../index.html#module-Import">Ppxlib__.Import</a>.option <span class="keyword">&#8209;&gt;</span> <a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a><span class="keyword"> * </span><a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a>) <span class="keyword">&#8209;&gt;</span> ?&#8288;impl:(<a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a> <span class="keyword">&#8209;&gt;</span> <a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a>) <span class="keyword">&#8209;&gt;</span> ?&#8288;intf:(<a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a> <span class="keyword">&#8209;&gt;</span> <a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a>) <span class="keyword">&#8209;&gt;</span> ?&#8288;lint_impl:(<a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a> <span class="keyword">&#8209;&gt;</span> <a href="Lint_error/index.html#type-t">Lint_error.t</a> <a href="../index.html#module-Import">Ppxlib__.Import</a>.list) <span class="keyword">&#8209;&gt;</span> ?&#8288;lint_intf:(<a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a> <span class="keyword">&#8209;&gt;</span> <a href="Lint_error/index.html#type-t">Lint_error.t</a> <a href="../index.html#module-Import">Ppxlib__.Import</a>.list) <span class="keyword">&#8209;&gt;</span> ?&#8288;preprocess_impl:(<a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a> <span class="keyword">&#8209;&gt;</span> <a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a>) <span class="keyword">&#8209;&gt;</span> ?&#8288;preprocess_intf:(<a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a> <span class="keyword">&#8209;&gt;</span> <a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a>) <span class="keyword">&#8209;&gt;</span> ?&#8288;aliases:<a href="../index.html#module-Import">Ppxlib__.Import</a>.string <a href="../index.html#module-Import">Ppxlib__.Import</a>.list <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.string <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"><p><code class="code">register_transformation name</code> registers a code transformation.</p><p><code class="code">name</code> is a logical name for the transformation (such as <code class="code">sexp_conv</code> or
<code class="code">bin_prot</code>). It is mostly used for debugging purposes.</p><p><code class="code">rules</code> is a list of context independent rewriting rules, such as extension point
expanders. This is what most code transformation should use. Rules from all registered
transformations are all applied at the same time, before any other
transformations. Moreover they are applied in a top-down manner, giving more control
to extensions on how they interpret their payload.</p><p>For instance:</p><ul><li>some extensions capture a pretty-print of the payload in their expansion and using
top-down ensures that the payload is as close as possible to the original code</li><li>some extensions process other extension in a special way inside their payload. For
instance <code class="code">%here</code> (from ppx_here) will normally expand to a record of type
<code class="code">Lexing.position</code>. However when used inside <code class="code">%sexp</code> (from ppx_sexp_value) it will
expand to the human-readable sexp representation of a source code position.</li></ul><p><code class="code">extensions</code> is a special cases of <code class="code">rules</code> and is deprecated. It is only kept for
backward compatibility.</p><p><code class="code">enclose_impl</code> and <code class="code">enclose_intf</code> produces a header and footer for
implementation/interface files. They are a special case of <code class="code">impl</code> and <code class="code">intf</code>. Both
functions receive a location that denotes the whole file, or <code class="code">None</code> if the file
contains nothing.</p><p><code class="code">impl</code> is an optional function that is applied on implementation files and <code class="code">intf</code> is
an optional function that is applied on interface files. These two functions are
applied on the AST of the whole file. They should only be used when the other
mechanism are not enough. For instance if the transformation expands extension points
that depend on the context.</p><p>If no rewriter is using <code class="code">impl</code> and <code class="code">intf</code>, then the whole transformation is completely
independent of the order in which the various rewriter are specified. Moreover the
resulting driver will be faster as it will do only one pass (excluding safety checks)
on the whole AST.</p><p><code class="code">lint_impl</code> and <code class="code">lint_intf</code> are applied to the unprocessed source. Errors they return
will be reported to the user as preprocessor warnings.</p><p><code class="code">preprocess_impl</code> and <code class="code">preprocess_intf</code> are applied after linters,
but before other transformations.</p></div></div><div class="spec val" id="val-register_transformation_using_ocaml_current_ast"><a href="#val-register_transformation_using_ocaml_current_ast" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>register_transformation_using_ocaml_current_ast : ?&#8288;impl:(Migrate_parsetree.OCaml_current.Ast.Parsetree.structure <span class="keyword">&#8209;&gt;</span> Migrate_parsetree.OCaml_current.Ast.Parsetree.structure) <span class="keyword">&#8209;&gt;</span> ?&#8288;intf:(Migrate_parsetree.OCaml_current.Ast.Parsetree.signature <span class="keyword">&#8209;&gt;</span> Migrate_parsetree.OCaml_current.Ast.Parsetree.signature) <span class="keyword">&#8209;&gt;</span> ?&#8288;aliases:<a href="../index.html#module-Import">Ppxlib__.Import</a>.string <a href="../index.html#module-Import">Ppxlib__.Import</a>.list <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.string <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"><p>Same as <code class="code">register_transformation</code> except that it uses the same AST as the current
ocaml compiler.</p><p>This is not the intended way of using driver. This is only for ppx rewriters that
are not written using ppxlib but want to export a driver compatible
library.</p></div></div><div class="spec val" id="val-register_code_transformation"><a href="#val-register_code_transformation" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>register_code_transformation : name:<a href="../index.html#module-Import">Ppxlib__.Import</a>.string <span class="keyword">&#8209;&gt;</span> ?&#8288;aliases:<a href="../index.html#module-Import">Ppxlib__.Import</a>.string <a href="../index.html#module-Import">Ppxlib__.Import</a>.list <span class="keyword">&#8209;&gt;</span> impl:(<a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a> <span class="keyword">&#8209;&gt;</span> <a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a>) <span class="keyword">&#8209;&gt;</span> intf:(<a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a> <span class="keyword">&#8209;&gt;</span> <a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a>) <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"><p>Same as:</p><pre><code class="code">      register_transformation
        ~name
        ~impl
        ~intf
        ()</code></pre><ul class="at-tag"><li><span class="at-tag deprecated">Deprecated</span> [since 2015-11] use register_transformation instead</li></ul></div></div><div class="spec val" id="val-register_correction"><a href="#val-register_correction" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>register_correction : loc:<a href="../../Ppxlib/Location/index.html#type-t">Ppxlib.Location.t</a> <span class="keyword">&#8209;&gt;</span> repl:<a href="../index.html#module-Import">Ppxlib__.Import</a>.string <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"><p>Rewriters might call this function to suggest a correction to the code source. When
they do this, the driver will generate a <code class="code">file.ml.ppx-corrected</code> file with the
suggested replacement. The build system will then show the diff to the user who is
free to accept the correction or not.</p></div></div><div class="spec val" id="val-register_process_file_hook"><a href="#val-register_process_file_hook" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>register_process_file_hook : (<a href="../index.html#module-Import">Ppxlib__.Import</a>.unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit) <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"><p>Hook called before processing a file</p></div></div><div class="spec module" id="module-Create_file_property"><a href="#module-Create_file_property" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Create_file_property/index.html">Create_file_property</a> : <span class="keyword">functor</span> (<a href="Create_file_property/argument-1-Name/index.html">Name</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span>) -&gt; <span class="keyword">functor</span> (<a href="Create_file_property/index.html#argument-2-T">T</a> : <a href="../index.html#module-Import">Ppxlib__.Import</a>.Sexpable.S) -&gt; <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Create a new file property.</p></div></div><div class="spec val" id="val-standalone"><a href="#val-standalone" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>standalone : <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"><p>Suitable for -pp and also usable as a standalone command line tool.</p><p>If the first command line argument is <code class="code">-as-ppx</code> then it will run as a ppx rewriter.</p></div></div><div class="spec val" id="val-run_as_ppx_rewriter"><a href="#val-run_as_ppx_rewriter" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run_as_ppx_rewriter : <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"><p>Suitable for -ppx. Used only for the public release.</p></div></div><div class="spec val" id="val-pretty"><a href="#val-pretty" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pretty : <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.bool</code></div><div class="doc"><p>If <code class="code">true</code>, code transformations should avoid generating code that is not strictly
necessary, such as extra type annotations.</p></div></div></body></html>