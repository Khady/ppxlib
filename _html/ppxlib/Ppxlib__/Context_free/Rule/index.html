<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Rule (ppxlib.Ppxlib__.Context_free.Rule)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../../index.html">ppxlib</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Ppxlib__.Context_free.Rule</span></h1></header><div class="doc"><p>Local rewriting rules.</p><p>This module lets you define local rewriting rules, such as extension point
expanders. It is not completely generic and you cannot define any kind of rewriting,
it currently focuses on what is commonly used. New scheme can be added on demand.</p><p>We have some ideas to make this fully generic, but this hasn't been a priority so
far.</p></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-extension"><a href="#val-extension" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>extension : <a href="../../../Ppxlib/Extension/index.html#type-t">Ppxlib.Extension.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Rewrite an extension point</p></div></div><div class="spec val" id="val-special_function"><a href="#val-special_function" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>special_function : <a href="../../index.html#module-Import">Ppxlib__.Import</a>.string <span class="keyword">&#8209;&gt;</span> (<a href="../../Import/index.html#type-expression">Ppxlib__.Import.expression</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Import/index.html#type-expression">Ppxlib__.Import.expression</a> <a href="../../index.html#module-Import">Ppxlib__.Import</a>.option) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">special_function id expand</code> is a rule to rewrite a function call at parsing time.
<code class="code">id</code> is the identifier to match on and <code class="code">expand</code> is used to expand the full function
application (it gets the Pexp_apply node). If the function is found in the tree
without being applied, <code class="code">expand</code> gets only the identifier (Pexp_ident node) so you
should handle both cases.</p><p><code class="code">expand</code> must decide whether the expression it receive can be rewritten or not.
Especially ppxlib makes the assumption that <code class="code">expand</code> is idempotent. It will loop
if it is not.</p></div></div><div class="spec module" id="module-Constant_kind"><a href="#module-Constant_kind" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Constant_kind/index.html">Constant_kind</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Used for the <code class="code">constant</code> function.</p></div></div><div class="spec val" id="val-constant"><a href="#val-constant" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>constant : <a href="Constant_kind/index.html#type-t">Constant_kind.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../../index.html#module-Import">Ppxlib__.Import</a>.char <span class="keyword">&#8209;&gt;</span> (<a href="../../../Ppxlib/Location/index.html#type-t">Ppxlib.Location.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../../index.html#module-Import">Ppxlib__.Import</a>.string <span class="keyword">&#8209;&gt;</span> <a href="../../../Ppxlib_ast__/Import/index.html#module-Parsetree">Ppxlib__.Import.Parsetree</a>.expression) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">constant kind suffix expander</code> Registers an extension for transforming constants
literals, based on the suffix character.</p></div></div><p>The rest of this API is for rewriting rules that apply when a certain attribute is
present. The API is not complete and is currently only enough to implement
deriving.</p><div class="spec type" id="type-attr_group_inline"><a href="#type-attr_group_inline" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('a, 'b, 'c) attr_group_inline</code><code><span class="keyword"> = </span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="../../../Ppxlib/Attribute/index.html#type-t">Ppxlib.Attribute.t</a> <span class="keyword">&#8209;&gt;</span> (loc:<a href="../../../Ppxlib/Location/index.html#type-t">Ppxlib.Location.t</a> <span class="keyword">&#8209;&gt;</span> path:<a href="../../index.html#module-Import">Ppxlib__.Import</a>.string <span class="keyword">&#8209;&gt;</span> <a href="../../../Ppxlib_ast__/Import/index.html#module-Asttypes">Ppxlib__.Import.Asttypes</a>.rec_flag <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <a href="../../index.html#module-Import">Ppxlib__.Import</a>.list <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> <a href="../../index.html#module-Import">Ppxlib__.Import</a>.option <a href="../../index.html#module-Import">Ppxlib__.Import</a>.list <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="../../index.html#module-Import">Ppxlib__.Import</a>.list) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code><code></code></div><div class="doc"><p>Match the attribute on a group of items, such as a group of recursive type
definitions (Pstr_type, Psig_type). The expander will be triggered if any of the
item has the attribute. The expander is called as follow:</p><p><code class="code">expand ~loc ~path rec_flag items values</code></p><p>where <code class="code">values</code> is the list of values associated to the attribute for each item in
<code class="code">items</code>. <code class="code">expand</code> must return a list of element to add after the group. For instance
a list of structure item to add after a group of type definitions.</p></div></div><div class="spec val" id="val-attr_str_type_decl"><a href="#val-attr_str_type_decl" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_str_type_decl : (<a href="../../Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../Import/index.html#type-type_declaration">Ppxlib__.Import.type_declaration</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_group_inline">attr_group_inline</a></code></div><div class="doc"></div></div><div class="spec val" id="val-attr_sig_type_decl"><a href="#val-attr_sig_type_decl" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_sig_type_decl : (<a href="../../Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../Import/index.html#type-type_declaration">Ppxlib__.Import.type_declaration</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_group_inline">attr_group_inline</a></code></div><div class="doc"></div></div><div class="spec val" id="val-attr_str_type_decl_expect"><a href="#val-attr_str_type_decl_expect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_str_type_decl_expect : (<a href="../../Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../Import/index.html#type-type_declaration">Ppxlib__.Import.type_declaration</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_group_inline">attr_group_inline</a></code></div><div class="doc"><p>The _expect variants are for producing code that is compared to what the user wrote
in the source code.</p></div></div><div class="spec val" id="val-attr_sig_type_decl_expect"><a href="#val-attr_sig_type_decl_expect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_sig_type_decl_expect : (<a href="../../Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../Import/index.html#type-type_declaration">Ppxlib__.Import.type_declaration</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_group_inline">attr_group_inline</a></code></div><div class="doc"></div></div><div class="spec type" id="type-attr_inline"><a href="#type-attr_inline" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('a, 'b, 'c) attr_inline</code><code><span class="keyword"> = </span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="../../../Ppxlib/Attribute/index.html#type-t">Ppxlib.Attribute.t</a> <span class="keyword">&#8209;&gt;</span> (loc:<a href="../../../Ppxlib/Location/index.html#type-t">Ppxlib.Location.t</a> <span class="keyword">&#8209;&gt;</span> path:<a href="../../index.html#module-Import">Ppxlib__.Import</a>.string <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="../../index.html#module-Import">Ppxlib__.Import</a>.list) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code><code></code></div><div class="doc"><p>Same as <code class="code">attr_group_inline</code> but for elements that are not part of a group, such as
exceptions and type extensions</p></div></div><div class="spec val" id="val-attr_str_type_ext"><a href="#val-attr_str_type_ext" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_str_type_ext : (<a href="../../Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../Import/index.html#type-type_extension">Ppxlib__.Import.type_extension</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_inline">attr_inline</a></code></div><div class="doc"></div></div><div class="spec val" id="val-attr_sig_type_ext"><a href="#val-attr_sig_type_ext" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_sig_type_ext : (<a href="../../Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../Import/index.html#type-type_extension">Ppxlib__.Import.type_extension</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_inline">attr_inline</a></code></div><div class="doc"></div></div><div class="spec val" id="val-attr_str_type_ext_expect"><a href="#val-attr_str_type_ext_expect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_str_type_ext_expect : (<a href="../../Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../Import/index.html#type-type_extension">Ppxlib__.Import.type_extension</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_inline">attr_inline</a></code></div><div class="doc"></div></div><div class="spec val" id="val-attr_sig_type_ext_expect"><a href="#val-attr_sig_type_ext_expect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_sig_type_ext_expect : (<a href="../../Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../Import/index.html#type-type_extension">Ppxlib__.Import.type_extension</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_inline">attr_inline</a></code></div><div class="doc"></div></div><div class="spec val" id="val-attr_str_exception"><a href="#val-attr_str_exception" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_str_exception : (<a href="../../Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../Import/index.html#type-extension_constructor">Ppxlib__.Import.extension_constructor</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_inline">attr_inline</a></code></div><div class="doc"></div></div><div class="spec val" id="val-attr_sig_exception"><a href="#val-attr_sig_exception" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_sig_exception : (<a href="../../Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../Import/index.html#type-extension_constructor">Ppxlib__.Import.extension_constructor</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_inline">attr_inline</a></code></div><div class="doc"></div></div><div class="spec val" id="val-attr_str_exception_expect"><a href="#val-attr_str_exception_expect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_str_exception_expect : (<a href="../../Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../Import/index.html#type-extension_constructor">Ppxlib__.Import.extension_constructor</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_inline">attr_inline</a></code></div><div class="doc"></div></div><div class="spec val" id="val-attr_sig_exception_expect"><a href="#val-attr_sig_exception_expect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attr_sig_exception_expect : (<a href="../../Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../Import/index.html#type-extension_constructor">Ppxlib__.Import.extension_constructor</a>, <span class="type-var">_</span>) <a href="index.html#type-attr_inline">attr_inline</a></code></div><div class="doc"></div></div></body></html>