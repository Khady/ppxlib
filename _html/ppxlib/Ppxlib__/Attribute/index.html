<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Attribute (ppxlib.Ppxlib__.Attribute)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">ppxlib</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Ppxlib__.Attribute</span></h1></header><p>Attribute hygiene</p><p>This module provides hygiene for attributes. The goal is to report misuses of
attributes to the user as soon as possible so that no mistyped attribute get silently
ignored.</p><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('context, 'payload) t</code><code></code><code></code></div><div class="doc"><p>Type of declared attribute.</p><p>The <code class="code">'context</code> type parameter describes where the attribute is expected and the
<code class="code">'payload</code> one what its payload should contain.</p></div></div><div class="spec type" id="type-packed"><a href="#type-packed" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>packed</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-packed.T" class="anchored"><td class="def constructor"><a href="#type-packed.T" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">T</span><span class="keyword"> : </span>(<span class="type-var">_</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-packed">packed</a></code></td></tr></table><code></code></div><div class="doc"></div></div><div class="spec module" id="module-Context"><a href="#module-Context" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Context/index.html">Context</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec val" id="val-declare"><a href="#val-declare" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>declare : <a href="../index.html#module-Import">Ppxlib__.Import</a>.string <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="Context/index.html#type-t">Context.t</a> <span class="keyword">&#8209;&gt;</span> (<a href="../Import/index.html#type-payload">Ppxlib__.Import.payload</a>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="../../Ppxlib/Ast_pattern/index.html#type-t">Ppxlib.Ast_pattern.t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'c</span>) <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">declare fully_qualified_name context payload_pattern k</code> declares an attribute. <code class="code">k</code> is
used to build the value resulting from parsing the payload.</p><p>For instance if a rewriter named &quot;foo&quot; expect the attribute <code class="code">@@default</code> on record
field declaration with an expression as payload:</p><pre><code class="code">      let default =
        Attribute.declare &quot;foo.default&quot;
          Attribute.Context.label_declaration
          Ast_pattern.(pstr (pstr_eval __ nil))
          (fun x -&gt; x)
      ;;</code></pre><p><code class="code">fully_qualified_name</code> is expected to be a dot-separated list of names. When matching,
any full suffix will be accepted. So for instance an attribute declared with name
&quot;foo.bar.default&quot; will match exactly these attribute names: &quot;default&quot;, &quot;bar.default&quot;
and &quot;foo.bar.default&quot;.</p><p>Additionally it is possible to prevent a suffix to be shortened by prefixing it with
'@'. So for instance an attribute declared with name &quot;foo.</p><ul class="at-tag"><li><p><span class="at-tag bar.default">@bar.default</span> &quot; will match
exactly these attribute names: &quot;bar.default&quot; and &quot;foo.bar.default&quot;.</p><p>When matching against a list of attributes on an item, if several matches are
possible, the longest one is used. For instance using the attribute &quot;foo.default&quot;
declared in the previous example, on this code it will match the <code class="code">@foo.default 0</code>
attribute:</p><pre><code class="code">      type t =
        { x : int [@default 42] [@foo.default 0]
        }</code></pre><p>This is to allow the user to specify a <code class="code">@default</code> attribute for all re-writers that
use it but still put a specific one for one specific re-writer.</p><p>It is not allowed to declare an attribute with a name that matches a
previously-defined one on the same context. For instance trying to declare the same
attribute twice will fail.</p></li></ul></div></div><div class="spec val" id="val-name"><a href="#val-name" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>name : (<span class="type-var">_</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.string</code></div><div class="doc"></div></div><div class="spec val" id="val-context"><a href="#val-context" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>context : (<span class="type-var">'a</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="Context/index.html#type-t">Context.t</a></code></div><div class="doc"></div></div><div class="spec val" id="val-get"><a href="#val-get" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get : (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.option</code></div><div class="doc"></div></div><div class="spec val" id="val-consume"><a href="#val-consume" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>consume : (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span><span class="keyword"> * </span><span class="type-var">'b</span>) <a href="../index.html#module-Import">Ppxlib__.Import</a>.option</code></div><div class="doc"><p><code class="code">consume t x</code> returns the value associated to attribute <code class="code">t</code> on <code class="code">x</code> if present as well
as <code class="code">x</code> with <code class="code">t</code> removed.</p></div></div><div class="spec val" id="val-remove_seen"><a href="#val-remove_seen" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>remove_seen : <span class="type-var">'a</span> <a href="Context/index.html#type-t">Context.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-packed">packed</a> <a href="../index.html#module-Import">Ppxlib__.Import</a>.list <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span></code></div><div class="doc"><p><code class="code">remove_seen x attrs</code> removes the set of attributes matched by elements of
<code class="code">attrs</code>. Only remove them if they where seen by <a href="index.html#val-get">get</a> or <a href="index.html#val-consume">consume</a>.</p></div></div><div class="spec module" id="module-Floating"><a href="#module-Floating" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Floating/index.html">Floating</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec val" id="val-explicitly_drop"><a href="#val-explicitly_drop" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>explicitly_drop : <a href="../../Ppxlib/Ast_traverse/class-iter/index.html">Ppxlib.Ast_traverse.iter</a></code></div><div class="doc"><p>Code that is voluntarily dropped by a rewriter needs to be given to this object. All
attributes inside will be marked as handled.</p></div></div><div class="spec val" id="val-check_unused"><a href="#val-check_unused" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>check_unused : <a href="../../Ppxlib/Ast_traverse/class-iter/index.html">Ppxlib.Ast_traverse.iter</a></code></div><div class="doc"><p>Raise if there are unused attributes</p></div></div><div class="spec val" id="val-freshen_and_collect"><a href="#val-freshen_and_collect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>freshen_and_collect : <a href="../../Ppxlib/Ast_traverse/class-map/index.html">Ppxlib.Ast_traverse.map</a></code></div><div class="doc"><p>Replace all attribute names by a <code class="code">String.copy</code> and collect them. To be used in
conjuction with <a href="index.html#val-check_all_seen">check_all_seen</a>.</p></div></div><div class="spec val" id="val-check_all_seen"><a href="#val-check_all_seen" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>check_all_seen : <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"><p>Check that all attributes collected by <a href="index.html#val-freshen_and_collect">freshen_and_collect</a> have been:</p><ul><li>matched at least once by one of: <a href="index.html#val-get">get</a>, <a href="index.html#val-consume">consume</a> or <a href="Floating/index.html#val-convert">Floating.convert</a></li><li>seen by <code class="code">check_unused</code> (to allow white-listed attributed to pass through)</li></ul><p>This helps with faulty ppx rewriters that silently drop attributes.</p></div></div><div class="spec val" id="val-mark_as_handled_manually"><a href="#val-mark_as_handled_manually" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>mark_as_handled_manually : <a href="../Import/index.html#type-attribute">Ppxlib__.Import.attribute</a> <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"><p>Mark an attribute as seen and handled. This is only to make ppx rewriters that don't
use ppxlib works well with the ones that do use it.</p></div></div><div class="spec val" id="val-dropped_so_far_structure"><a href="#val-dropped_so_far_structure" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dropped_so_far_structure : <a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a> <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.string <a href="../../Ppxlib/Loc/index.html#type-t">Ppxlib.Loc.t</a> <a href="../index.html#module-Import">Ppxlib__.Import</a>.list</code></div><div class="doc"><p>Return the list of attributes that have been dropped so far: attributes that haven't
been marked and are not present in the given AST. This is used to debug extensions
that drop attributes.</p></div></div><div class="spec val" id="val-dropped_so_far_signature"><a href="#val-dropped_so_far_signature" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dropped_so_far_signature : <a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a> <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.string <a href="../../Ppxlib/Loc/index.html#type-t">Ppxlib.Loc.t</a> <a href="../index.html#module-Import">Ppxlib__.Import</a>.list</code></div><div class="doc"></div></div><div class="spec val" id="val-reset_checks"><a href="#val-reset_checks" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>reset_checks : <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.unit</code></div><div class="doc"></div></div><div class="spec val" id="val-pattern"><a href="#val-pattern" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pattern : (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>) <a href="../../Ppxlib/Ast_pattern/index.html#type-t">Ppxlib.Ast_pattern.t</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span> <a href="../index.html#module-Import">Ppxlib__.Import</a>.option <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span>, <span class="type-var">'d</span>) <a href="../../Ppxlib/Ast_pattern/index.html#type-t">Ppxlib.Ast_pattern.t</a></code></div><div class="doc"></div></div></body></html>